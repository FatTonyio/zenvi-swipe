<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Zenvi Scent Swipe</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      padding: 0;
      background: #E5D5C3;
      font-family: 'Inter', sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      overflow: hidden;
    }

    #tinder {
      position: relative;
      width: 340px;
      height: 520px;
    }

    .card {
      position: absolute;
      width: 100%;
      height: 100%;
      background: white;
      border-radius: 20px;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
      padding: 16px;
      text-align: center;
      cursor: grab;
      transition: transform 0.3s ease, opacity 0.3s ease;
      user-select: none;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .card img {
      width: 100%;
      height: 260px;
      object-fit: cover;
      border-radius: 16px;
    }

    .card h2 {
      font-size: 20px;
      color: #1A1A1A;
      margin: 12px 0 4px;
    }

    .card p {
      font-size: 14px;
      color: #555;
      margin: 0;
    }

    .end-message {
      font-size: 20px;
      color: #1A1A1A;
      text-align: center;
    }
  </style>
</head>
<body>

<div id="tinder">Loading scents...</div>

<script>
  const SHEETDB_URL = "https://sheetdb.io/api/v1/1ihsui12t3ue1";

  fetch("https://zenvi.com.au/products.json")
    .then(res => res.json())
    .then(data => {
      const products = data.products.slice(0, 15).reverse();
      const tinder = document.getElementById("tinder");
      tinder.innerHTML = "";

      products.forEach(product => {
        const card = document.createElement("div");
        card.className = "card";
        card.dataset.title = product.title;
        card.dataset.notes = product.body_html.replace(/<[^>]+>/g, '').substring(0, 100) + '...';
        card.innerHTML = `
          <img src="${product.images[0]?.src}" alt="${product.title}">
          <h2>${product.title}</h2>
          <p>${card.dataset.notes}</p>
        `;
        tinder.appendChild(card);
        addSwipeBehavior(card);
      });
    });

  function addSwipeBehavior(card) {
    let isDragging = false;
    let startX = 0, currentX = 0;

    card.addEventListener("mousedown", (e) => {
      isDragging = true;
      startX = e.clientX;
      card.style.transition = "none";
    });

    document.addEventListener("mousemove", (e) => {
      if (!isDragging) return;
      currentX = e.clientX - startX;
      card.style.transform = `translateX(${currentX}px) rotate(${currentX / 15}deg)`;
    });

    document.addEventListener("mouseup", () => {
      if (!isDragging) return;
      isDragging = false;
      card.style.transition = "transform 0.3s ease";

      if (Math.abs(currentX) > 120) {
        const direction = currentX > 0 ? "right" : "left";
        card.style.transform = `translateX(${currentX * 4}px) rotate(${currentX / 2}deg)`;
        setTimeout(() => {
          handleSwipe(card, direction);
        }, 300);
      } else {
        card.style.transform = `translateX(0px) rotate(0deg)`;
      }
    });
  }

  function handleSwipe(card, dir) {
    const scent = {
      id: Date.now(),
      name: card.dataset.title,
      notes: card.dataset.notes,
      opinion: dir === "right" ? "like" : "dislike",
      timestamp: new Date().toISOString()
    };

    sendToSheet(scent);
    card.remove();

    if (!document.querySelector(".card")) {
      document.getElementById("tinder").innerHTML = `<div class="end-message">Thanks for swiping!<br>Your preferences have been noted üïØÔ∏è</div>`;
    }
  }

  function sendToSheet(data) {
    fetch(SHEETDB_URL, {
      method: "POST",
      body: JSON.stringify({ data }),
      headers: {
        "Content-Type": "application/json"
      }
    })
    .then(res => res.json())
    .then(res => console.log("‚úÖ Logged to SheetDB:", res))
    .catch(err => console.error("‚ùå Error:", err));
  }
</script>

</body>
</html>
